fragment TaskViewModel on Task {
  name
  id
  effectiveDueDate
  completed
  effectivelyCompleted
  containingProject {
    id
    name
  }
  flagged
}

query GetTasks(
  $onlyFlagged: Boolean! = false
  $onlyAvailable: Boolean! = false
  $withEffectiveDueDate: Boolean! = false
) {
  defaultDocument {
    flattenedTasks
      @whose(
        condition: {
          operator: "and"
          operands: [
            { field: "effectivelyCompleted", value: "false" }
            { field: "flagged", enabled: $onlyFlagged }
            {
              operator: "not"
              operands: [{ field: "effectiveDeferDate", value: "null", enabled: $withEffectiveDueDate }]
            }
            {
              enabled: $onlyAvailable
              operator: "or"
              operands: [
                { field: "effectiveDeferDate", operator: "=", value: "null" }
                { field: "effectiveDeferDate", operator: "<", value: "new Date()" }
              ]
            }
          ]
        }
      ) {
      edges {
        node {
          ...TaskViewModel
        }
      }
    }
  }
}

query GetInboxTasks {
  defaultDocument {
    inboxTasks
      @whose(
        condition: {
          operator: "and"
          operands: [
            { field: "effectivelyCompleted", value: "false" }
            {
              operator: "or"
              operands: [
                { field: "effectiveDeferDate", operator: "=", value: "null" }
                { field: "effectiveDeferDate", operator: "<", value: "new Date()" }
              ]
            }
          ]
        }
      ) {
      edges {
        node {
          ...TaskViewModel
        }
      }
    }
  }
}

query GetTasksInProject($projectId: String!) {
  defaultDocument {
    projects {
      byId(id: $projectId) {
        rootTask {
          tasks {
            edges {
              node {
                ...TaskViewModel
              }
            }
          }
        }
      }
    }
  }
}

query GetNestedProjects {
  defaultDocument {
    folders {
      edges {
        node {
          name
          id
          projects {
            edges {
              node {
                name
                completed
                id
                numberOfAvailableTasks
              }
            }
          }
        }
      }
    }
  }
}

query GetTasksWithTag($tagId: String!) {
  defaultDocument {
    tags {
      byId(id: $tagId) {
        tasks {
          edges {
            node {
              ...TaskViewModel
            }
          }
        }
      }
    }
  }
}

query GetTopLevelProjects {
  defaultDocument {
    folders {
      edges {
        node {
          name
          id
          projects {
            edges {
              node {
                name
                completed
                id
                numberOfAvailableTasks
              }
            }
          }
        }
      }
    }
    projects {
      edges {
        node {
          id
          name
          completed
          numberOfAvailableTasks
        }
      }
    }
  }
}

query GetTaskCreationSupportInfo {
  defaultDocument {
    folders {
      edges {
        node {
          name
          id
          projects {
            edges {
              node {
                name
                completed
                id
                numberOfAvailableTasks
              }
            }
          }
        }
      }
    }
    projects {
      edges {
        node {
          id
          name
          completed
          numberOfAvailableTasks
        }
      }
    }
    tags {
      edges {
        node {
          name
          id
          tags {
            edges {
              node {
                name
                id
              }
            }
          }
        }
      }
    }
  }
}

query GetNestedTags {
  defaultDocument {
    tags {
      edges {
        node {
          name
          id
          tags {
            edges {
              node {
                name
                id
              }
            }
          }
        }
      }
    }
  }
}

query GetPerspectiveNames {
  defaultDocument {
    perspectiveNames
  }
}
